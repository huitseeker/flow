---
title: Epoch Preparation Protocol
sidebar_title: Epoch Protocol
description: Technical Overview of Epoch
---

<Callout type="warning">
  If you haven't read the Intro to Flow Staking document, please read that
  first. That document provides a non-technical overview of staking on Flow for
  all users and is a necessary prerequisite to this document.
</Callout>
<Callout type="warning">
  This document assumes you have some technical knowledge about the Flow
  blockchain and programming environment.
</Callout>

# Epochs

This document describes the functionality of the [epoch smart contracts](https://github.com/onflow/flow-core-contracts/blob/master/contracts/epochs).
It gives an overview of the process of epochs, the staking auction, and the epoch setup and commit phases.
It is an important prerequisite to understand before proceeding with any other technical integration or interaction with the Flow Protocol,
but does not provide step-by-step instructions for how to perform specific actions.

This document also describes how to read public epoch data from the contracts.
Anyone with a Flow account on mainnet can read public data from the epoch smart contracts with these instructions.

The transactions described in this document are contained in the [`flow-core-contracts/transactions/epoch/`](https://github.com/onflow/flow-core-contracts/tree/master/transactions/epoch)
directory. You can see the text of all the transactions used to interact with the smart contracts there.

## Terminology

If any of the definitions are confusing, you can find more detail in the [Smart Contract Summary](#Smart-Contract-Summary)

**Staker:** Any user who has staked tokens for the Flow network.
A node operator is a staker, and a delegator is a staker as well.

**Node Operator:** A user who operates a node on the Flow network. Each node operator has a unique `NodeStaker`
object they store in their account to perform staking operations.

**Delegator:** A user who delegates tokens to a node operator and receives rewards for their staked tokens, minus a fee
taken by the node operator. Each delegator stores a unique `NodeDelegator` object in their account
that allows them to perform staking operations.

**Identity Table:** The record of all the stakers in the network.
The identity table keeps separate lists for the info about node operators and delegators,
which track the following info:

- **Node Operators:**

  - Node ID: 32 byte identifier for the node. Usually a hash of the node public key.
  - Role: Indicates what role the node operator is. (Collection, Consensus, Execution, Verification, Access)
  - Networking Address: The address that the node operator uses for networking.
  - Networking Key: The 64 byte node operator public key for networking.
  - Staking Key: The 96 byte public key for the account that manages staking.

**Epoch:** The period of time between reward payments and changes in the identity table. (Initially a week)
At the end of every epoch, insufficiently staked node operators are refunded their stake,
rewards are paid to those who are currently staked, committed tokens are marked as staked,
unstaking tokens are marked as unstaked, and unstaking requests are changed from staked to unstaking.

## Smart Contract Summary

TODO

Epoch Schedule:

1. **Start of Epoch:** Generic metadata about the current epoch is updated and shared.
2. **Staking Auction:** Stakers can perform any action they want to manage their stake, like
   initially registering, staking new tokens, unstaking tokens, or withdrawing rewards.
   This phase takes up the vast majority of time in the epoch.
3. **Rewards Payout:** Pay rewards to all the node operators staked in the current epoch.
4. **Remove Insufficiently Staked Nodes:** All node operators who don't meet the minimum
   or are not operating their node properly will be removed.
5. **Move tokens between pools.** (See the token pools section for the order of movements)

The `FlowEpoch` contract manages all of these phases, the `FlowIDTableStaking` contract
manages the identity table and staking auction, the `FlowClusterQC` contract manages
the Quorum Certificate generation for collector clusters, and the `FlowDKG` contract manages
the Distributed Key Generation protocol for the consensus nodes.

Initially, control of these phases and contracts will be managed manually by the Flow Token Admin,
but control will eventually be completely decentralized and managed by the node software, smart contracts,
and democratically by all the stakers in the network.

# Query Information from the Epoch Contract

There is a lot of information that can be queried from the epoch contract in different ways.

ADD SCRIPTS DOCS HERE

# Monitor Epoch Events

See the epoch events document for detailed documentation about the events that are emitted by the epoch contract.

# Appendix

TODO
